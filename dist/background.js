(()=>{"use strict";const e=["imgur","reddit","messenger","linkedin","news.google"].map((function(e){return new RegExp("https?://(www.)?[-a-zA-Z0-9@:%._+~#=]{0,256}"+e+".[-a-zA-Z0-9@:%._+~#=]{1,256}(/)?")}));function t(e){return"boolean"==typeof e}function n(e){return null===e||"string"==typeof e}function r(e){return"number"==typeof e||null===e}function o(e){return new Promise((function(t,n){chrome.storage.local.get(e,(function(r){if(chrome.runtime.lastError)return n(chrome.runtime.lastError);var o=r[e];t(o)}))}))}function i(e){return new Promise((function(t,n){chrome.tabs.get(e,(function(){if(chrome.runtime.lastError)return n(chrome.runtime.lastError);t(!0)}))}))}function c(e,t){return new Promise((function(n,r){chrome.tabs.remove(e,(function(){if(chrome.runtime.lastError)return r(chrome.runtime.lastError);console.log("BACKEND: removed tab",{tabId:e,tabUrl:t}),n()}))}))}var s=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,s)}u((r=r.apply(e,t||[])).next())}))},u=function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((o=(o=c.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function l(e){var t={type:"IS_BLOCKING_STATUS",isBlocking:e};chrome.runtime.sendMessage(t)}function a(e){chrome.storage.local.set({isBlocking:e}),l(e)}function m(e){var t={type:"BLOCKING_TIMESTAMP",timestamp:e};chrome.runtime.sendMessage(t)}function f(e){chrome.storage.local.set({blockingTimestamp:e}),m(e)}function g(e){chrome.storage.local.set({blockingTimerId:e})}!function(){s(this,void 0,void 0,(function(){var e,t;return u(this,(function(r){switch(r.label){case 0:return chrome.storage.local.set({blockingTimerId:null}),[4,o("isBlocking")];case 1:return void 0===r.sent()&&chrome.storage.local.set({isBlocking:!0}),[4,o("blockingTimestamp")];case 2:if(!n(e=r.sent()))throw new TypeError("expected blockingTimestamp, got "+typeof e);return e?new Date(e).getTime()-Date.now()<0?(f(null),[2]):(new Date(e).getTime()-Date.now()>=0&&(t=setTimeout((function(){console.log("BACKEND: in set timeout, setting to null"),f(null),a(!0),g(null)}),new Date(e).getTime()-Date.now()),g(t)),[2]):(f(null),[2])}}))}))}(),chrome.tabs.onUpdated.addListener((function(n,r,l){return s(void 0,void 0,void 0,(function(){var r,s,a;return u(this,(function(u){switch(u.label){case 0:return[4,i(n).catch((function(e){return console.log(e.message,"get")}))];case 1:return u.sent()&&l.url?[4,o("isBlocking")]:[2];case 2:if(!t(r=!!u.sent()))throw new TypeError("expected isBlocking, got "+typeof r);if(!r)return[2];s=0,a=e,u.label=3;case 3:return s<a.length?a[s].test(l.url)?[4,c(n,l.url).catch((function(e){return console.log(e.message,"remove")}))]:[3,5]:[3,6];case 4:return u.sent(),[2];case 5:return s++,[3,3];case 6:return[2]}}))}))})),chrome.runtime.onSuspend.addListener((function(){return s(void 0,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return[4,o("blockingTimerId")];case 1:if(!r(e=t.sent()))throw new TypeError("expected blockingTimerId, got "+typeof e);return e&&clearTimeout(e),g(null),[2]}}))}))})),chrome.runtime.onMessage.addListener((function(e){return s(void 0,void 0,void 0,(function(){var i,c,s,p;return u(this,(function(u){switch(u.label){case 0:switch(e.type){case"REQ_IS_BLOCKING_STATUS":return[3,1];case"TOGGLE_IS_BLOCKING":return[3,3];case"REQ_BLOCKING_TIMESTAMP":return[3,4];case"SET_BLOCKING_TIMESTAMP":return[3,6]}return[3,9];case 1:return[4,o("isBlocking")];case 2:if(i=u.sent(),console.log("BACKEND: received request for blocking status",{isBlocking:i}),!t(i))throw new TypeError("expected isBlocking, got "+typeof i);return l(i),[3,10];case 3:return a(e.isBlocking),console.log("BACKEND: received request to toggle isBlocking status",{isBlocking:e.isBlocking}),[3,10];case 4:return[4,o("blockingTimestamp")];case 5:if(c=u.sent(),console.log("BACKEND: received request for blocking timestamp",{blockingTimestamp:c}),!n(c))throw new TypeError("expected isBlockingTimestamp, got "+typeof c);return m(c),[3,10];case 6:return console.log("BACKEND: received request to set blocking timestamp",{timestamp:e.timestamp}),e.timestamp?[3,8]:(console.log("INSIDE if statement for null timestamp"),f(e.timestamp),[4,o("blockingTimerId")]);case 7:if(!r(s=u.sent()))throw new TypeError("expected blockingTimerId, got "+typeof s);return s&&clearTimeout(s),g(null),[2];case 8:return console.log("INSIDE: after if statement for null timestamp"),f(e.timestamp),p=setTimeout((function(){console.log("BACKEND: in set timeout, setting to null"),f(null),a(!0),g(null)}),new Date(e.timestamp).getTime()-Date.now()),g(p),[3,10];case 9:return[3,10];case 10:return[2]}}))}))}))})();
//# sourceMappingURL=background.js.map