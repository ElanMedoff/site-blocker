(()=>{"use strict";var e=["imgur","youtube","reddit","messenger","linkedin","news.google"].map((function(e){return new RegExp("https?://(www.)?[-a-zA-Z0-9@:%._+~#=]{0,256}"+e+".[-a-zA-Z0-9@:%._+~#=]{1,256}(/)?")})),t=[].concat(["https://www.youtube.com/watch?v=2L2lnxIcNmo","https://www.youtube.com/watch?v=uW3-Ue07H0M"]),n=["list=PL4vyWz4g-OOEpsJbV21QuTVv9LO2miP5G"];function r(e){return"boolean"==typeof e}function o(e){return null===e||"string"==typeof e}function i(e){return"number"==typeof e||null===e}function c(e){return new Promise((function(t,n){chrome.storage.local.get(e,(function(r){if(chrome.runtime.lastError)return n(chrome.runtime.lastError);var o=r[e];t(o)}))}))}function s(e){return new Promise((function(t,n){chrome.tabs.get(e,(function(){if(chrome.runtime.lastError)return n(chrome.runtime.lastError);t(!0)}))}))}function u(e,t){return new Promise((function(n,r){chrome.tabs.remove(e,(function(){if(chrome.runtime.lastError)return r(chrome.runtime.lastError);console.log("BACKEND: removed tab",{tabId:e,tabUrl:t}),n()}))}))}var l=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,s)}u((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((o=(o=c.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function m(e){var t={type:"IS_BLOCKING_STATUS",isBlocking:e};chrome.runtime.sendMessage(t)}function f(e){chrome.storage.local.set({isBlocking:e}),m(e)}function g(e){var t={type:"BLOCKING_TIMESTAMP",timestamp:e};chrome.runtime.sendMessage(t)}function p(e){chrome.storage.local.set({blockingTimestamp:e}),g(e)}function h(e){chrome.storage.local.set({blockingTimerId:e})}!function(){l(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:return chrome.storage.local.set({blockingTimerId:null}),[4,c("isBlocking")];case 1:return void 0===n.sent()&&chrome.storage.local.set({isBlocking:!0}),[4,c("blockingTimestamp")];case 2:if(!o(e=n.sent()))throw new TypeError("expected blockingTimestamp, got "+typeof e);return e?new Date(e).getTime()-Date.now()<0?(p(null),[2]):(new Date(e).getTime()-Date.now()>=0&&(t=setTimeout((function(){console.log("BACKEND: in set timeout, setting to null"),p(null),f(!0),h(null)}),new Date(e).getTime()-Date.now()),h(t)),[2]):(p(null),[2])}}))}))}(),chrome.tabs.onUpdated.addListener((function(o,i,m){return l(void 0,void 0,void 0,(function(){var i,l,f,g,p,h,d,w;return a(this,(function(a){switch(a.label){case 0:return[4,s(o).catch((function(e){return console.log(e.message,"get")}))];case 1:return a.sent()&&m.url?[4,c("isBlocking")]:[2];case 2:if(!r(i=!!a.sent()))throw new TypeError("expected isBlocking, got "+typeof i);if(!i)return[2];for(l=0,f=t;l<f.length;l++)if(h=f[l],m.url===h)return[2];for(g=0,p=n;g<p.length;g++)if(h=p[g],console.log(m.url,m.url.includes(h)),m.url.includes(h))return[2];d=0,w=e,a.label=3;case 3:return d<w.length?w[d].test(m.url)?[4,u(o,m.url).catch((function(e){return console.log(e.message,"remove")}))]:[3,5]:[3,6];case 4:return a.sent(),[2];case 5:return d++,[3,3];case 6:return[2]}}))}))})),chrome.runtime.onSuspend.addListener((function(){return l(void 0,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,c("blockingTimerId")];case 1:if(!i(e=t.sent()))throw new TypeError("expected blockingTimerId, got "+typeof e);return e&&clearTimeout(e),h(null),[2]}}))}))})),chrome.runtime.onMessage.addListener((function(e){return l(void 0,void 0,void 0,(function(){var t,n,s,u;return a(this,(function(l){switch(l.label){case 0:switch(e.type){case"REQ_IS_BLOCKING_STATUS":return[3,1];case"TOGGLE_IS_BLOCKING":return[3,3];case"REQ_BLOCKING_TIMESTAMP":return[3,4];case"SET_BLOCKING_TIMESTAMP":return[3,6]}return[3,9];case 1:return[4,c("isBlocking")];case 2:if(t=l.sent(),console.log("BACKEND: received request for blocking status",{isBlocking:t}),!r(t))throw new TypeError("expected isBlocking, got "+typeof t);return m(t),[3,10];case 3:return f(e.isBlocking),console.log("BACKEND: received request to toggle isBlocking status",{isBlocking:e.isBlocking}),[3,10];case 4:return[4,c("blockingTimestamp")];case 5:if(n=l.sent(),console.log("BACKEND: received request for blocking timestamp",{blockingTimestamp:n}),!o(n))throw new TypeError("expected isBlockingTimestamp, got "+typeof n);return g(n),[3,10];case 6:return console.log("BACKEND: received request to set blocking timestamp",{timestamp:e.timestamp}),e.timestamp?[3,8]:(console.log("INSIDE if statement for null timestamp"),p(e.timestamp),[4,c("blockingTimerId")]);case 7:if(!i(s=l.sent()))throw new TypeError("expected blockingTimerId, got "+typeof s);return s&&clearTimeout(s),h(null),[2];case 8:return console.log("INSIDE: after if statement for null timestamp"),p(e.timestamp),u=setTimeout((function(){console.log("BACKEND: in set timeout, setting to null"),p(null),f(!0),h(null)}),new Date(e.timestamp).getTime()-Date.now()),h(u),[3,10];case 9:return[3,10];case 10:return[2]}}))}))}))})();
//# sourceMappingURL=background.js.map